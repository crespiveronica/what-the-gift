<div class="container">
  <h3 class="text-center">Administrar Usuarios</h3>
  <%= render 'shared/info_messages' %>

  <%= will_paginate @users %>

  <table class="table table-striped table-hover">
    <tr>
      <th>Nombre</th>
      <th>E-mail</th>
      <th>Estado</th>
      <th>Motivo</th>
      <th colspan="2">Acción</th>
    </tr>

    <% seq_id = 0 %>
    <% @users.each do |user| %>
      <tr class="users">
        <%= form_for user, url: disable_user_path(user), method: 'post' do |u| %>
          <td><%= user.full_name %></td>
          <td><%= user.email %></td>
          <td><%= user.banned ? 'Deshabilitado' : 'Habilitado' %></td>

          <% if user.banned %>
            <td><%= user.banned_reason %></td>
          <% else %>
            <td><%= u.text_field :banned_reason, :required => true, name: 'ban-reason' %></td>
          <% end %>

          <% if user.banned %>
            <td><%= link_to "Habilitar", enable_user_path(user), method: :post, class: "btn btn-info btn-small" %></td>
            <td><button type="button" class="btn btn-warning btn-small" disabled="disabled">Deshabilitar</button></td>
          <% else %>
            <td><button type="button" class="btn btn-info btn-small" disabled="disabled">Habilitar</button></td>
            <td><%= u.submit "Deshabilitar", class: "btn btn-warning btn-small", id: "ban-reason-btn-" + seq_id.to_s %></td>
          <% end %>

        <% end %>
      </tr>
      <% seq_id += 1 %>
    <% end %>

  </table>

  <%= will_paginate @users %>

</div>


<script type="text/javascript">
$(document).ready( function() {
    var elements = document.getElementsByName("ban-reason");
    for (var i = 0; i < elements.length; i++) {
        elements[i].oninvalid = function(e) {
            e.target.setCustomValidity("La razón no puede estar vacía");
        };
    }
});
</script>